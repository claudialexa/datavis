<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Crazy Elections: Weimar Germany</title>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
		<style type="text/css">
			body {
				background-color: #ffffff;
				font-family: sans-serif;
			}

			h2 {
				margin-left: 30px;
			}

			p {
				margin-left: 30px;
				font-size: 11pt;
				color: gray;
			}

			svg {
				background-color: white;
			}


			path {
				fill:none;
/*				stroke: black;
*/				stroke-width: 2px;
			}

			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				stroke-width: 1px;
				shape-rendering: crispEdges;
			}

			.line {
				fill: none;
				stroke-opacity: 60%;
				stroke-width: 2px;
			}

			.line.unfocused{
				stroke-opacity: 60%;
			}

			.line.focused {
				stroke-width: 4px;
				stroke-opacity: 100%;
/*				stroke: red;
*/			}

			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}

			.tooltip {
				position: absolute;
				z-index: 10;
			}

			.tooltip p {
				background-color: white;
				border: none;
				padding: 2px;
			}

			.xlabel {
				font-famile: sans-serif;
				font-size: 11px;
				color: gray;
			}
		</style>
	</head>

	<body>
		<h2>Crazy Elections: Weimar Germany</h2>

		<p> By the time World War I ended, the Germans had lost millions of lives and were in a deep economic depression. The unrest that followed the end of the war resulted in the overthrow of the empire and the formation of a new government, the Weimar Republic. </p>

		<p>This time in German history is remembered by the cultural renaissance of German society; the emergence of cabaret, Bauhaus and the arts. At the same time, it also saw some of the biggest political and economic failures, most highlighted by rampant hyperinflation and ulatimately, the government's inability to stop Adolf Hitler from coming to power in 1935. </p>

		<p>Leading to that fateful day in 1935, there were more elections and political parties around the country than Germans could count. Many (like the Nazi Party, once named the National Socialist German Workers' Party) appeared one day, died the next and revived in a few months. In following these patterns, historians have been able to understand the state of the German mindset and how the Nazi Party was actually able to get to power.</p>


		<script type="text/javascript">

			var fullwidth = 1000;
				fullheight = 500;

			var dateFormat = d3.time.format("%B %d %Y");

			var margin = {top: 20, right: 25, bottom: 20, left: 200};

			var width = fullwidth- margin.left - margin.right, 
				height = fullheight - margin.top - margin.bottom;

			// How can I access d.Party outside of nest?
			// var politicalParties = d3.nest()
			// 	.key(function (d){
			// 		return d.Party;
			// 	})

			var xScale = d3.time.scale().range([0, width]);
			var yScale = d3.scale.linear().range([0, height]);

			var xAxis = d3.svg.axis()
				.scale(xScale)
				.orient("bottom")
				.ticks(10)
				.innerTickSize([0]);

			var yAxis = d3.svg.axis()
				.scale(yScale)
				.orient("left")
				.innerTickSize([0]);

			// Building Lines

			var line = d3.svg.line()
				.x(function (d) {
					return xScale(dateFormat.parse(d.Date));
				})
				.y(function (d) {
					return yScale(+d.Votes);
				})
				.interpolate("basis");

			var tooltip = d3.select("body")
	      	.append("div")
	      	.attr("class", "tooltip");

			//Create the empty SVG image
			var svg = d3.select("body")
				.append("svg")
				.attr("width", fullwidth)
				.attr("height", fullheight)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			

			d3.csv("german_elections_final.csv", function (error,data) {

				if (error) {
					console.log("error reading file");
				}

				var dataset = d3.nest()
					.key(function (d) {
						return d.Party;
					})
					.sortValues(function (a, b) {
						return dateFormat.parse(a.Date) - dateFormat.parse(b.Date)
					})
					.entries(data);

				xScale.domain(
					d3.extent(data, function(d) {
						return dateFormat.parse(d.Date);
					}));


				yScale.domain([
					d3.max(data, function(d) {
							return +d.Votes;
					}),
					0
					]);

				var color = d3.scale.category10();

				var groups = svg.selectAll("g.lines")
					.data(dataset)
					.enter()
					.append("g")
					.attr("class", "lines");

				groups.selectAll("path")
					.data(function(d) { 
						return [ d.values ];
					})
					.enter()
					.append("path")
					.attr("class", "line")
					.style("stroke", function(d) {
						return color(d[0].Party); })
					.attr("d", line); 


				//Axes
				svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxis);

				svg.append("g")
					.attr("class", "y axis")
					.call(yAxis);


				d3.selectAll("g.lines")
					.on("mouseover", mouseoverFunc)
					.on("mouseout", mouseoutFunc)
					.on("mousemove", mousemoveFunc);

			});

		function mouseoverFunc(d) {

		d3.selectAll("path.line").classed("unfocused", true);
		d3.select(this).select("path.line").classed("unfocused", false).classed("focused", true);
		tooltip
			.style("display", null) // this removes the display none setting from it
			.html("<p>" + d.key + "</p>");
	}

	function mouseoutFunc() {
			d3.selectAll("path.line").classed("unfocused", false).classed("focused", false);
			tooltip.style("display", "none"); 
	}

	function mousemoveFunc(d) {
		tooltip
			.style("top", (d3.event.pageY - 10) + "px" )
			.style("left", (d3.event.pageX + 10) + "px");
	}

		</script>

	</body>
	</html>